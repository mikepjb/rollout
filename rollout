#!/bin/sh -e
# vim: fdm=marker

echo 'Rollout'

# Read Arguments & Environment {{{

if [ ${#@} -ne 0 ]; then
  case $* in
    *--help*) printf -- '...help...\n'; exit 0;;
    *-h*) printf -- '...help...\n'; exit 0;;
  esac
fi

# }}}

# Functions {{{

function check_network {
  if ping -q -c 1 -W 1 1.1.1.1 >/dev/null; then
    echo '--> We are online!'
  else
    echo '--> Network not established, exiting early..'
  fi
}

function check_command {
  if [ ! $(command -v $1) ]; then
    printf -- "You don't seem to have $1 installed.\n"
    exit 127
  # else
  #  echo "$1 is installed."
  fi
}

# }}}

# Basics
# Minimal configuration that needs no internet connection
# Tools/PATH {{{

echo '--> Do I have the basics?'

check_command grep
check_command 'vim'
check_command 'nvim'
check_command 'tmux'
# check_command 'screen' # todo this should be conditional

# }}}

# Locale.. things like LANG/keyboard setting caps as ctrl
# What should that be called? I guess this is the place to put most shellrc stuff
# Locale {{{

echo '--> What is my current keyboard layout?'
echo 'where should I write thing config to?'
echo "echo 'setxkbmap us etc > /etc/.bashrc'? "
echo '--> what is my timezone?'
echo '--> is there a time sync daemon?'
echo '--> am I inside docker? no init?'

if [ ! $(command -v /bin/bash) ]; then
  echo '!!! bash is not available'
  exit 1
fi

# TODO check arch linux for general recommendations

# }}}

# Have you considered, the aesthetics? {{{

echo '--> inside X'
echo '--> inside regular console'
# set ter-228b
# write to /etc/vconsole.conf
echo '--> hidpi'
# write to .xinitrc

echo '--> if openbox-session is available.. what's the fallback?

# }}}

echo '--> Is rollout or bin file on path?'


echo '--> Is git configured?'
echo 'what do I want to be there?'
echo 'aa + ci + maybe ra?'

echo '--> Do I have an ssh key?'
echo '--> Is systemd running?'
echo '--> Is ssh-agent running?'

# Colors {{{

echo 'choose night or day'

# take vars describes here, put them into their respective configs

# TODO should be if --sun/--moon/--lumo etc (lumo by default for now)
if true; then
  echo 'Sun theme'
# # Sun theme
# *.foreground:   #fcfcfa
# *.background:   #2d2a2e
# *.cursorColor:  #fcfcfa
# 
# ! black
# *.color0:       #383539
# *.color8:       #989599
# 
# ! red
# *.color1:       #ff6188
# *.color9:       #ff89a6
# 
# ! green
# *.color2:       #a9dc76
# *.color10:      #c5e0a9
# 
# ! yellow
# *.color3:       #fc9867
# *.color11:      #ffd866
# 
# ! blue
# *.color4:       #78dce8
# *.color12:      #c9edf1
# 
# ! magenta
# *.color5:       #ab9df2
# *.color13:      #b294bb
# 
# ! cyan
# *.color6:       #78e8cf
# *.color14:      #c4f9ed
# 
# ! white
# *.color7:       #c3c1c3
# *.color15:      #f8f8f2
fi


echo '--> Does my shell have colors set?'
echo '--> for X?'
echo '--> for OSX?'
echo '--> for Cygwin?'
echo '--> for Powershell?'
echo '--> for (neo)vim?'
echo '--> for emacs?'

# }}}

check_network

echo '--> Has git?'
echo '--> Maven?'
echo '--> openjdk 11 and src?'
echo '--> Has clojure/clj?'
echo '--> Has lein?'
echo '--> Has boot?'
echo '--> Has gimp?'
echo '--> terminus -- good default you can rely on?'

# Nice to have {{{

echo '--> Has rlwrap'

# }}}

# if --all-languages is selected try to install everything
echo '--> Has go?'
echo '--> Has haskell?'
echo '--> Has ruby?'
echo '--> Has node?'
echo '--> Has python?'
echo '--> Has gcc?'
echo '--> Has rust?'

echo '--> Hugo for blogs? or something different?'
echo '--> darkroom? gthumb? --extra? --full?'

# Technologies {{{
echo '--> Has postgresql?'
echo '--> Has redis?'
# }}}

# Window Management + everyday utils {{{

echo '--> scrot/screenshot util'
echo '--> slock'
echo '--> openbox?'
echo '--> in osx/windows are there any helpers?'

# }}}

# Design decisions
#
# Should rollout have softlinked files?
# Copy files stored inside a single sh file?
# echo minimal config?
#
# How destructive can rollout be? Could I use it on someone else's computer with confidence?
# maybe just mv to old if found? create new.. diff if diff then write over old
#
# Log what happened?
#
# How can I make output look pretty?
#
# # How do I source missing binaries?
# -> by package manager? select only a few supported platforms? e.g arch? nix?
